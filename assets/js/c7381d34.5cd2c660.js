"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[544],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return h}});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),d=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=d(e.components);return o.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},c=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=d(n),h=r,k=c["".concat(s,".").concat(h)]||c[h]||p[h]||a;return n?o.createElement(k,i(i({ref:t},u),{},{components:n})):o.createElement(k,i({ref:t},u))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var d=2;d<a;d++)i[d]=n[d];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}c.displayName="MDXCreateElement"},534:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return d},toc:function(){return u},default:function(){return c}});var o=n(7462),r=n(3366),a=(n(7294),n(3905)),i=["components"],l={title:"Overview"},s=void 0,d={unversionedId:"webhook",id:"webhook",title:"Overview",description:"Webhooks let you subscribe to real-time status updates of booking and deliveries generated by LODI. Rather than making an API call, LODI can send an HTTP(s) request to an endpoint that you specify. Published events are for all bookings created via API integration.",source:"@site/docs/webhook.md",sourceDirName:".",slug:"/webhook",permalink:"/lodi-api-documentation/webhook",tags:[],version:"current",frontMatter:{title:"Overview"},sidebar:"docs",previous:{title:"Track and Trace",permalink:"/lodi-api-documentation/api/track-and-trace"},next:{title:"Validate Webhook Notifications",permalink:"/lodi-api-documentation/validate-webhook"}},u=[{value:"Static Endpoint URL",id:"static-endpoint-url",children:[],level:2},{value:"HTTP(s) POST Method",id:"https-post-method",children:[],level:2},{value:"JSON Payload",id:"json-payload",children:[],level:2},{value:"Payload and Headers",id:"payload-and-headers",children:[],level:2},{value:"Header",id:"header",children:[{value:"<code>Content-Type</code>",id:"content-type",children:[],level:3},{value:"<code>x-lodi-signature</code>",id:"x-lodi-signature",children:[],level:3}],level:2},{value:"Responding to webhooks",id:"responding-to-webhooks",children:[],level:2},{value:"Webhook Payload",id:"webhook-payload",children:[],level:2}],p={toc:u};function c(e){var t=e.components,n=(0,r.Z)(e,i);return(0,a.kt)("wrapper",(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Webhooks let you subscribe to real-time status updates of booking and deliveries generated by LODI. Rather than making an API call, LODI can send an HTTP(s) request to an endpoint that you specify. Published events are for all bookings created via API integration."),(0,a.kt)("p",null,"LODI rider performs trip actions that the LODI server receives. These events are processed and then posted to your servers on Webhooks. A webhook is an HTTP(s) POST call from the LODI server to a configurable destination."),(0,a.kt)("p",null,"After receiving a webhook on your server, you can trigger updates on your web apps in near real-time and implement your live status updates features."),(0,a.kt)("p",null,"Setting up LODI Webhooks requires configurations on your server and the LODI developer."),(0,a.kt)("p",null,"The server receiving webhooks needs appropriate configurations to consume webhooks."),(0,a.kt)("h2",{id:"static-endpoint-url"},"Static Endpoint URL"),(0,a.kt)("p",null,"Your server needs to expose a public HTTP(s) endpoint to receive external, incoming requests. It is crucial to have a static endpoint URL that will be accessible at all times."),(0,a.kt)("h2",{id:"https-post-method"},"HTTP(s) POST Method"),(0,a.kt)("p",null,"Your configured endpoint will be receiving webhooks through HTTP(s) POST requests. Your server needs to support this method and parse the payload provided with the request."),(0,a.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"If you are running a local development environment, please refer to tools like ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/localtunnel/localtunnel"},"localtunnel")," to expose your local endpoints through the public internet."))),(0,a.kt)("h2",{id:"json-payload"},"JSON Payload"),(0,a.kt)("p",null,"The payload you will receive with POST requests is formatted in JSON. It would be best to implement parsing JSON objects to leverage the HTTP request body content."),(0,a.kt)("p",null,"It would help if you used a JSON parser to convert the escaped representation of control characters back to their ASCII character values (for example, converting \\n to a newline character). This implementation is critical if you want to verify the signature of a webhook."),(0,a.kt)("h2",{id:"payload-and-headers"},"Payload and Headers"),(0,a.kt)("p",null,"LODI will send webhooks with headers and a JSON payload. Please verify the headers and implement your server to handle these correctly."),(0,a.kt)("h2",{id:"header"},"Header"),(0,a.kt)("h3",{id:"content-type"},(0,a.kt)("inlineCode",{parentName:"h3"},"Content-Type")),(0,a.kt)("p",null,"The header's value is ",(0,a.kt)("inlineCode",{parentName:"p"},"application/json")," for all webhooks. Please ensure to parse every webhook with this content type. The actual content is in JSON."),(0,a.kt)("h3",{id:"x-lodi-signature"},(0,a.kt)("inlineCode",{parentName:"h3"},"x-lodi-signature")),(0,a.kt)("p",null,"LODI signs each webhook POST request. Please see this ",(0,a.kt)("a",{parentName:"p",href:"validate-webhook"},"guide")," for further instructions."),(0,a.kt)("h2",{id:"responding-to-webhooks"},"Responding to webhooks"),(0,a.kt)("p",null,"Make sure to respond to LODI webhooks with the appropriate status code. The connection will time out in 3 seconds. If your endpoint does not respond before the connection times out or if your endpoint returns a status code outside the range of 200\u20134xx, LODI will consider the delivery of the webhook as a failed attempt and will not retry anymore."),(0,a.kt)("h2",{id:"webhook-payload"},"Webhook Payload"),(0,a.kt)("p",null,"The overall POST payload has a static structure."),(0,a.kt)("p",null,"For pickup status updates, with the ff. rider actions:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Accept booking assignment"),(0,a.kt)("li",{parentName:"ul"},"Start pickup trip"),(0,a.kt)("li",{parentName:"ul"},"Arrived at pickup address"),(0,a.kt)("li",{parentName:"ul"},"Complete pickup")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  // updated booking status\n  "booking_status": {\n    "booking_no": "220203-1E-0001", // LODI\'s booking number\n    "reference_no": "XXXXXX", // might be your own booking number\n    "status": "ACCEPTED", // possible values are ACCEPTED, OUT FOR PICKUP, REACHED PICKUP, PICKUP COMPLETE\n    "status_timestamp": "2022-02-03 08:33:28 AM"\n  },\n  // no delivery status updates yet\n  "delivery_status": null,\n  // rider attribute will be included if booking is not yet COMPLETED or CANCELLED else this will not be included in the payload\n  "rider": {\n    "full_name": "Jay Remollo",\n    "contact_no": "9123456789"\n  }\n}\n')),(0,a.kt)("p",null,"For delivery status updates, with the ff. rider actions:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Start delivery trip"),(0,a.kt)("li",{parentName:"ul"},"Arrived at delivery address"),(0,a.kt)("li",{parentName:"ul"},"Complete delivery"),(0,a.kt)("li",{parentName:"ul"},"Fail delivery")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  // updated booking status\n  "booking_status": {\n    "booking_no": "220203-1E-0001", // LODI\'s booking number\n    "reference_no": "XXXXXX", // might be your own booking number\n    "status": "PICKUP COMPLETE", // possible values are PICKUP COMPLETE, COMPLETED\n    "status_timestamp": "2022-02-03 08:33:28 AM"\n  },\n  // updated delivery status\n  "delivery_status": {\n    "order": 1, // value depends on what drop number the rider is currently processing\n    "is_rts": false,\n    "status": "OUT FOR DELIVERY", // possible values are OUT FOR DELIVERY, ARRIVED, DELIVERY COMPLETE, FAILED\n    "status_timestamp": "2022-02-03 08:33:28 AM"\n  },\n  // rider attribute will be included if booking is not yet COMPLETED or CANCELLED else this will not be included in the payload\n  "rider": {\n    "full_name": "Jay Remollo",\n    "contact_no": "9123456789"\n  }\n}\n')),(0,a.kt)("p",null,"The only difference between the two is the value for the ",(0,a.kt)("inlineCode",{parentName:"p"},"delivery_status"),". It can be null or has value."))}c.isMDXComponent=!0}}]);